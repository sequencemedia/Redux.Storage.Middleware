'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _actions=require('./actions');function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}var isStale=function isStale(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$cachedAt=_ref.cachedAt,cachedAt=_ref$cachedAt===undefined?0:_ref$cachedAt,_ref$cacheFor=_ref.cacheFor,cacheFor=_ref$cacheFor===undefined?0:_ref$cacheFor;return cachedAt+cacheFor<Date.now();};var isHardStorage=function isHardStorage(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$cacheFor=_ref2.cacheFor,cacheFor=_ref2$cacheFor===undefined?0:_ref2$cacheFor;return cacheFor>=1000*60*60*24;};var isSoftStorage=function isSoftStorage(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$cacheFor=_ref3.cacheFor,cacheFor=_ref3$cacheFor===undefined?0:_ref3$cacheFor;return cacheFor>=1000*60*60&&cacheFor<1000*60*60*24;};var hasComparator=function hasComparator(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$comparator=_ref4.comparator,comparator=_ref4$comparator===undefined?null:_ref4$comparator;return comparator instanceof Function;};var filterFor=function filterFor(t){return function(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref5.type;return type===t;};};var filterMetaFor=function filterMetaFor(t){return function(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$meta=_ref6.meta;_ref6$meta=_ref6$meta===undefined?{}:_ref6$meta;var type=_ref6$meta.type;return type===t;};};var mapType=function mapType(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref7.type;return type;};var mapMetaType=function mapMetaType(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$meta=_ref8.meta;_ref8$meta=_ref8$meta===undefined?{}:_ref8$meta;var type=_ref8$meta.type;return type;};var mapCacheFor=function mapCacheFor(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$meta=_ref9.meta;_ref9$meta=_ref9$meta===undefined?{}:_ref9$meta;var _ref9$meta$cacheFor=_ref9$meta.cacheFor,cacheFor=_ref9$meta$cacheFor===undefined?0:_ref9$meta$cacheFor;return cacheFor;};var mapCachedAt=function mapCachedAt(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$meta=_ref10.meta;_ref10$meta=_ref10$meta===undefined?{}:_ref10$meta;var _ref10$meta$cachedAt=_ref10$meta.cachedAt,cachedAt=_ref10$meta$cachedAt===undefined?0:_ref10$meta$cachedAt;return cachedAt;};var createIsHardStorage=function createIsHardStorage(meta){return _extends({},meta,isHardStorage(meta)?{isHardStorage:true}:{});};var createIsSoftStorage=function createIsSoftStorage(meta){return _extends({},meta,isSoftStorage(meta)?{isSoftStorage:true}:{});};var createComparator=function createComparator(){var _ref11=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref11$comparator=_ref11.comparator,comparator=_ref11$comparator===undefined?null:_ref11$comparator,meta=_objectWithoutProperties(_ref11,['comparator']);return _extends({},meta,comparator?{comparator:comparator}:{});};var createAccessedAt=function createAccessedAt(){var _ref12=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref12$accessedAt=_ref12.accessedAt,accessedAt=_ref12$accessedAt===undefined?null:_ref12$accessedAt,meta=_objectWithoutProperties(_ref12,['accessedAt']);return _extends({},meta,accessedAt?{accessedAt:accessedAt}:{});};var createCachedAt=function createCachedAt(){var _ref13=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref13$cachedAt=_ref13.cachedAt,cachedAt=_ref13$cachedAt===undefined?null:_ref13$cachedAt,meta=_objectWithoutProperties(_ref13,['cachedAt']);return _extends({},meta,cachedAt?{cachedAt:cachedAt}:{});};var createCacheFor=function createCacheFor(){var _ref14=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref14$cacheFor=_ref14.cacheFor,cacheFor=_ref14$cacheFor===undefined?null:_ref14$cacheFor,meta=_objectWithoutProperties(_ref14,['cacheFor']);return _extends({},meta,cacheFor?{cacheFor:cacheFor}:{});};var createMeta=function createMeta(){var meta=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return createIsHardStorage(createIsSoftStorage(createCacheFor(createCachedAt(createAccessedAt(createComparator(meta))))));};var hasCacheFor=function hasCacheFor(value){return!isNaN(value)&&!!value;};var notCacheFor=function notCacheFor(value){return isNaN(value)||!value;};var filterFetch=function filterFetch(){var _ref15=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref15$meta=_ref15.meta;_ref15$meta=_ref15$meta===undefined?{}:_ref15$meta;var type=_ref15$meta.type,_ref15$meta$cacheFor=_ref15$meta.cacheFor,cacheFor=_ref15$meta$cacheFor===undefined?0:_ref15$meta$cacheFor;return hasCacheFor(cacheFor);};var filterStore=function filterStore(){var _ref16=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref16$meta=_ref16.meta;_ref16$meta=_ref16$meta===undefined?{}:_ref16$meta;var type=_ref16$meta.type,_ref16$meta$cacheFor=_ref16$meta.cacheFor,cacheFor=_ref16$meta$cacheFor===undefined?0:_ref16$meta$cacheFor;return hasCacheFor(cacheFor);};var filterClear=function filterClear(){var _ref17=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref17$meta=_ref17.meta;_ref17$meta=_ref17$meta===undefined?{}:_ref17$meta;var type=_ref17$meta.type,_ref17$meta$cacheFor=_ref17$meta.cacheFor,cacheFor=_ref17$meta$cacheFor===undefined?0:_ref17$meta$cacheFor;return notCacheFor(cacheFor);};var min=function min(values){return Math.min.apply(Math,_toConsumableArray(values));};var max=function max(values){return Math.max.apply(Math,_toConsumableArray(values));};var reduceFetch=function reduceFetch(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref18=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref18.type,meta=_ref18.meta,_ref18$meta=_ref18.meta;_ref18$meta=_ref18$meta===undefined?{}:_ref18$meta;var _ref18$meta$cacheFor=_ref18$meta.cacheFor,cacheFor=_ref18$meta$cacheFor===undefined?0:_ref18$meta$cacheFor;var i=arguments[2];var array=arguments[3];return a.map(mapType).includes(type)?a:min(array.filter(filterFor(type)).map(mapCacheFor))!==cacheFor?a:a.concat(_extends({type:type},meta?{meta:meta}:{}));};var reduceStore=function reduceStore(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref19=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref19.type,meta=_ref19.meta,_ref19$meta=_ref19.meta;_ref19$meta=_ref19$meta===undefined?{}:_ref19$meta;var _ref19$meta$cacheFor=_ref19$meta.cacheFor,cacheFor=_ref19$meta$cacheFor===undefined?0:_ref19$meta$cacheFor;var i=arguments[2];var array=arguments[3];return a.map(mapType).includes(type)?a:min(array.filter(filterFor(type)).map(mapCacheFor))!==cacheFor?a:a.concat(_extends({type:type},meta?{meta:meta}:{}));};var reduceClear=function reduceClear(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref20=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref20.type,meta=_ref20.meta,_ref20$meta=_ref20.meta;_ref20$meta=_ref20$meta===undefined?{}:_ref20$meta;var _ref20$meta$cacheFor=_ref20$meta.cacheFor,cacheFor=_ref20$meta$cacheFor===undefined?0:_ref20$meta$cacheFor;var i=arguments[2];var array=arguments[3];return a.map(mapType).includes(type)?a:min(array.filter(filterFor(type)).map(mapCacheFor))!==cacheFor?a:a.concat(_extends({type:type},meta?{meta:meta}:{}));};var dedupeFetch=function dedupeFetch(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref21=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref21.type,meta=_ref21.meta;return a.map(mapType).includes(type)?a:a.concat(_extends({type:type},meta?{meta:meta}:{}));};var dedupeStore=function dedupeStore(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref22=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref22.type,meta=_ref22.meta,_ref22$meta=_ref22.meta;_ref22$meta=_ref22$meta===undefined?{}:_ref22$meta;var t=_ref22$meta.type;return a.map(mapMetaType).includes(t)?a:a.concat(_extends({type:type},meta?{meta:meta}:{}));};var dedupeClear=function dedupeClear(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref23=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref23.type,meta=_ref23.meta,_ref23$meta=_ref23.meta;_ref23$meta=_ref23$meta===undefined?{}:_ref23$meta;var t=_ref23$meta.type;return a.map(mapMetaType).includes(t)?a:a.concat(_extends({type:type},meta?{meta:meta}:{}));};var filterHardStorage=function filterHardStorage(){var _ref24=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref24.meta;return isHardStorage(meta);};var filterSoftStorage=function filterSoftStorage(){var _ref25=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref25.meta;return isSoftStorage(meta);};var filterStorage=function filterStorage(){var _ref26=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref26.meta;return!(isHardStorage(meta)||isSoftStorage(meta));};var filterNotFetchMap=function filterNotFetchMap(){var _ref27=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref27$fetchMap=_ref27.fetchMap,fetchMap=_ref27$fetchMap===undefined?new Map():_ref27$fetchMap;var _ref28=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref28$meta=_ref28.meta;_ref28$meta=_ref28$meta===undefined?{}:_ref28$meta;var type=_ref28$meta.type;return!fetchMap.has(type);};var filterNotStoreMap=function filterNotStoreMap(){var _ref29=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref29$storeMap=_ref29.storeMap,storeMap=_ref29$storeMap===undefined?new Map():_ref29$storeMap;var _ref30=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref30$meta=_ref30.meta;_ref30$meta=_ref30$meta===undefined?{}:_ref30$meta;var type=_ref30$meta.type;return!storeMap.has(type);};var filterIsUniqueMap=function filterIsUniqueMap(){var _ref31=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref31$fetchMap=_ref31.fetchMap,fetchMap=_ref31$fetchMap===undefined?new Map():_ref31$fetchMap,_ref31$storeMap=_ref31.storeMap,storeMap=_ref31$storeMap===undefined?new Map():_ref31$storeMap;var _ref32=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref32$meta=_ref32.meta;_ref32$meta=_ref32$meta===undefined?{}:_ref32$meta;var type=_ref32$meta.type;return!(fetchMap.has(type)||storeMap.has(type));};var putIntoFetchMap=function putIntoFetchMap(){var _ref33=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref33$fetchMap=_ref33.fetchMap,fetchMap=_ref33$fetchMap===undefined?new Map():_ref33$fetchMap;var _ref34=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref34.type,_ref34$meta=_ref34.meta;_ref34$meta=_ref34$meta===undefined?{}:_ref34$meta;var cacheFor=_ref34$meta.cacheFor,comparator=_ref34$meta.comparator;fetchMap.set(type,_extends({type:type,cacheFor:cacheFor},comparator instanceof Function?{comparator:comparator}:{}));};var putIntoStoreMap=function putIntoStoreMap(){var _ref36=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref36$storeMap=_ref36.storeMap,storeMap=_ref36$storeMap===undefined?new Map():_ref36$storeMap;var _ref35=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=_ref35.type,_ref35$meta=_ref35.meta;_ref35$meta=_ref35$meta===undefined?{}:_ref35$meta;var TYPE=_ref35$meta.type,meta=_objectWithoutProperties(_ref35$meta,['type']);var storeSet=storeMap.get(TYPE)||new Set();storeMap.set(TYPE,storeSet.add(_extends({},meta,{type:type})));};var putIntoClearMap=function putIntoClearMap(){var _ref38=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref38$clearMap=_ref38.clearMap,clearMap=_ref38$clearMap===undefined?new Map():_ref38$clearMap;var _ref37=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var type=_ref37.type,_ref37$meta=_ref37.meta;_ref37$meta=_ref37$meta===undefined?{}:_ref37$meta;var TYPE=_ref37$meta.type,cacheFor=_ref37$meta.cacheFor,meta=_objectWithoutProperties(_ref37$meta,['type','cacheFor']);var clearSet=clearMap.get(TYPE)||new Set();clearMap.set(TYPE,clearSet.add(_extends({},meta,{type:type},cacheFor?{cacheFor:cacheFor}:{},{isNaN:isNaN(cacheFor)})));};var putIntoFetchMetaMap=function putIntoFetchMetaMap(){var _ref40=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref40$fetchMetaMap=_ref40.fetchMetaMap,fetchMetaMap=_ref40$fetchMetaMap===undefined?new Map():_ref40$fetchMetaMap;var _ref39=arguments[1];var type=_ref39.type,_ref39$meta=_ref39.meta,cacheFor=_ref39$meta.cacheFor,meta=_objectWithoutProperties(_ref39$meta,['cacheFor']);var fetchMetaSet=fetchMetaMap.get(type)||new Set();fetchMetaMap.set(type,fetchMetaSet.add(_extends({},meta,{cacheFor:cacheFor})));};var putIntoStoreMetaMap=function putIntoStoreMetaMap(){var _ref42=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref42$storeMetaMap=_ref42.storeMetaMap,storeMetaMap=_ref42$storeMetaMap===undefined?new Map():_ref42$storeMetaMap;var _ref41=arguments[1];var _ref41$meta=_ref41.meta,type=_ref41$meta.type,cacheFor=_ref41$meta.cacheFor;var storeMetaSet=storeMetaMap.get(type)||new Set();storeMetaMap.set(type,storeMetaSet.add({type:type,cacheFor:cacheFor}));};var filterStoreHardStorageArray=function filterStoreHardStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterHardStorage);};var filterStoreSoftStorageArray=function filterStoreSoftStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterSoftStorage);};var filterStoreStorageArray=function filterStoreStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterStorage);};var filterFetchArray=function filterFetchArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterFetch);};var filterStoreArray=function filterStoreArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterStore);};var filterClearArray=function filterClearArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterClear);};var filterNotFetchMapArray=function filterNotFetchMapArray(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return array.filter(function(item){return filterNotFetchMap(params,item);});};var filterIsUniqueMapArray=function filterIsUniqueMapArray(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return array.filter(function(item){return filterIsUniqueMap(params,item);});};var createStoreMetaArray=function createStoreMetaArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceStore,[]).reduce(dedupeStore,[]);};function initialiseFetchMetaMap(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];array.forEach(function(item){return putIntoFetchMetaMap(params,item);});}function initialiseStoreMetaMap(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];array.forEach(function(item){return putIntoStoreMetaMap(params,item);});}function initialiseFetchHardStorage(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];filterStoreHardStorageArray(array).reduce(reduceFetch,[]).forEach(function(item){return putIntoFetchMap(params,item);});}function initialiseFetchSoftStorage(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];filterStoreSoftStorageArray(array).reduce(reduceFetch,[]).forEach(function(item){return putIntoFetchMap(params,item);});}function initialiseFetchStorage(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];filterStoreStorageArray(array).reduce(reduceFetch,[]).forEach(function(item){return putIntoFetchMap(params,item);});}function initialiseFetch(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var fetchArray=filterFetchArray(array);initialiseFetchHardStorage(params,fetchArray);initialiseFetchSoftStorage(params,fetchArray);initialiseFetchStorage(params,fetchArray);}function initialiseStoreNotFetchMap(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];filterNotFetchMapArray(params,array).reduce(reduceStore,[]).forEach(function(item){return putIntoStoreMap(params,item);});}function initialiseStoreHardStorage(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var hardStorageArray=filterStoreHardStorageArray(array);initialiseStoreNotFetchMap(params,hardStorageArray);var hardStorageMetaArray=createStoreMetaArray(hardStorageArray);initialiseFetchMetaMap(params,hardStorageMetaArray);initialiseStoreMetaMap(params,hardStorageMetaArray);}function initialiseStoreSoftStorage(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var softStorageArray=filterStoreSoftStorageArray(array);initialiseStoreNotFetchMap(params,softStorageArray);var softStorageMetaArray=createStoreMetaArray(softStorageArray);initialiseFetchMetaMap(params,softStorageMetaArray);initialiseStoreMetaMap(params,softStorageMetaArray);}function initialiseStoreStorage(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var storageArray=filterStoreStorageArray(array);initialiseStoreNotFetchMap(params,storageArray);var storageMetaArray=createStoreMetaArray(storageArray);initialiseFetchMetaMap(params,storageMetaArray);initialiseStoreMetaMap(params,storageMetaArray);}function initialiseStore(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var storeArray=filterStoreArray(array);initialiseStoreHardStorage(params,storeArray);initialiseStoreSoftStorage(params,storeArray);initialiseStoreStorage(params,storeArray);}function initialiseClearIsUniqueMap(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];filterIsUniqueMapArray(params,array).reduce(reduceClear,[]).forEach(function(item){return putIntoClearMap(params,item);});}function initialiseClear(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var clearArray=filterClearArray(array);initialiseClearIsUniqueMap(params,clearArray);}function initialise(){var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];initialiseFetch(params,array);initialiseStore(params,array);initialiseClear(params,array);}exports.default=function(array){if(Array.isArray(array)){var fetchMap=new Map();var storeMap=new Map();var fetchMetaMap=new Map();var storeMetaMap=new Map();var clearMap=new Map();initialise({fetchMap:fetchMap,storeMap:storeMap,fetchMetaMap:fetchMetaMap,storeMetaMap:storeMetaMap,clearMap:clearMap},array);return function(store){return function(next){return function(){var _ref43=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var type=_ref43.type,action=_objectWithoutProperties(_ref43,['type']);if(fetchMap.has(type)){var defaultMeta=fetchMap.get(type);var _store$getState=store.getState(),_store$getState$redux=_store$getState.reduxStorage;_store$getState$redux=_store$getState$redux===undefined?{}:_store$getState$redux;var _store$getState$redux2=_store$getState$redux[type];_store$getState$redux2=_store$getState$redux2===undefined?{}:_store$getState$redux2;var _store$getState$redux3=_store$getState$redux2.meta,meta=_store$getState$redux3===undefined?defaultMeta:_store$getState$redux3;if(hasComparator(defaultMeta)){var cacheFor=defaultMeta.cacheFor,comparator=defaultMeta.comparator;var cachedAt=meta.cachedAt;var META=createMeta({type:type,cacheFor:cacheFor,cachedAt:cachedAt,comparator:comparator,then:function then(_ref44){var type=_ref44.type,action=_objectWithoutProperties(_ref44,['type']);var accessedAt=Date.now();if(fetchMetaMap.has(type)){var fetchMetaSet=fetchMetaMap.get(type);fetchMetaSet.forEach(function(_ref45){var type=_ref45.type,cacheFor=_ref45.cacheFor;var META=createMeta({type:type,cacheFor:cacheFor,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(META));});}var META=createMeta({type:type,cacheFor:cacheFor,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(META,_extends({},action,{type:type})));return _extends({},action,{type:type});}});store.dispatch((0,_actions.storageCompareAction)(META,_extends({},action,{type:type})));return _extends({},action,{type:type});}else{var _cacheFor=defaultMeta.cacheFor;var _cachedAt=meta.cachedAt;var _META=createMeta({type:type,cacheFor:_cacheFor,cachedAt:_cachedAt});if(isStale(_META)){return next(_extends({},action,{type:type}));}else{var accessedAt=Date.now();if(fetchMetaMap.has(type)){var fetchMetaSet=fetchMetaMap.get(type);fetchMetaSet.forEach(function(_ref46){var type=_ref46.type,cacheFor=_ref46.cacheFor;var META=createMeta({type:type,cacheFor:cacheFor,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(META));});}var _META2=createMeta({type:type,cacheFor:_cacheFor,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(_META2,_extends({},action,{type:type})));return _extends({},action,{type:type});}}}else{if(storeMap.has(type)){var _cachedAt2=Date.now();if(storeMetaMap.has(type)){var storeMetaSet=storeMetaMap.get(type);storeMetaSet.forEach(function(_ref47){var type=_ref47.type,cacheFor=_ref47.cacheFor;var META=createMeta({type:type,cacheFor:cacheFor,cachedAt:_cachedAt2});store.dispatch((0,_actions.storageStoreAction)(META,_extends({},action,{type:type})));});}var storeSet=storeMap.get(type);storeSet.forEach(function(_ref48){var type=_ref48.type,cacheFor=_ref48.cacheFor;var META=createMeta({type:type,cacheFor:cacheFor,cachedAt:_cachedAt2});store.dispatch((0,_actions.storageStoreAction)(META));});return next(_extends({},action,{type:type}));}else{if(clearMap.has(type)){var clearSet=clearMap.get(type);clearSet.forEach(function(_ref49){var type=_ref49.type;if(fetchMetaMap.has(type)){var _fetchMetaSet=fetchMetaMap.get(type);_fetchMetaSet.forEach(function(_ref50){var type=_ref50.type;if(storeMap.has(type)){if(storeMetaMap.has(type)){var _storeMetaSet=storeMetaMap.get(type);_storeMetaSet.forEach(function(_ref51){var type=_ref51.type,cacheFor=_ref51.cacheFor;var META=createMeta({type:type,cacheFor:cacheFor});store.dispatch((0,_actions.storageClearAction)(META,_extends({},action,{type:type})));});}var _storeSet=storeMap.get(type);_storeSet.forEach(function(_ref52){var type=_ref52.type,cacheFor=_ref52.cacheFor;var META=createMeta({type:type,cacheFor:cacheFor});store.dispatch((0,_actions.storageClearAction)(META));});}});}});return next(_extends({},action,{type:type}));}}}return next(_extends({},action,{type:type}));};};};}return function(){return function(next){return function(action){return next(action);};};};};