"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initialiseFetchMetaMap=initialiseFetchMetaMap;exports.initialiseFetchHardStorage=initialiseFetchHardStorage;exports.initialiseFetchSoftStorage=initialiseFetchSoftStorage;exports.initialiseFetchStorage=initialiseFetchStorage;exports.initialiseFetch=initialiseFetch;exports.initialiseStoreMetaMap=initialiseStoreMetaMap;exports.initialiseStoreNotFetchMap=initialiseStoreNotFetchMap;exports.initialiseStoreHardStorage=initialiseStoreHardStorage;exports.initialiseStoreSoftStorage=initialiseStoreSoftStorage;exports.initialiseStoreStorage=initialiseStoreStorage;exports.initialiseStore=initialiseStore;exports.initialiseClearIsUniqueMap=initialiseClearIsUniqueMap;exports.initialiseClear=initialiseClear;exports.initialise=initialise;exports.default=exports.getCacheFor=exports.getCachedAt=exports.createStoreMetaArray=exports.createFetchMetaArray=exports.filterIsUniqueMapArray=exports.filterNotFetchMapArray=exports.filterClearArray=exports.filterStoreArray=exports.filterFetchArray=exports.filterStorageArray=exports.filterSoftStorageArray=exports.filterHardStorageArray=exports.putIntoStoreMetaMap=exports.putIntoFetchMetaMap=exports.putIntoClearMap=exports.putIntoStoreMap=exports.putIntoFetchMap=exports.filterIsUniqueMap=exports.filterNotStoreMap=exports.filterNotFetchMap=exports.filterStorage=exports.filterSoftStorage=exports.filterHardStorage=exports.dedupeMetaStore=exports.dedupeMetaFetch=exports.dedupeClear=exports.dedupeStore=exports.dedupeFetch=exports.reduceMetaStore=exports.reduceMetaFetch=exports.reduceClear=exports.reduceStore=exports.reduceFetch=exports.dedupeMeta=exports.reduce=exports.filterClear=exports.filterStore=exports.filterFetch=exports.notCacheFor=exports.hasCacheFor=exports.createMeta=exports.createCacheFor=exports.createCachedAt=exports.createAccessedAt=exports.createComparator=exports.createIsSoftStorage=exports.createIsHardStorage=exports.mapCachedAt=exports.mapCacheFor=exports.mapMetaType=exports.mapType=exports.filterMetaFor=exports.filterFor=exports.hasComparator=exports.isSoftStorage=exports.isHardStorage=exports.isEqual=exports.isStale=exports.max=exports.min=void 0;var _actions=require("./actions");function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key];}}return target;}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}return target;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable;}));}ownKeys.forEach(function(key){_defineProperty(target,key,source[key]);});}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}}var min=function min(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return Math.min.apply(Math,_toConsumableArray(values));};exports.min=min;var max=function max(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return Math.max.apply(Math,_toConsumableArray(values));};exports.max=max;var isStale=function isStale(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$cachedAt=_ref.cachedAt,cachedAt=_ref$cachedAt===void 0?0:_ref$cachedAt,_ref$cacheFor=_ref.cacheFor,cacheFor=_ref$cacheFor===void 0?0:_ref$cacheFor;return cachedAt+cacheFor<Date.now();};exports.isStale=isStale;var isEqual=function isEqual(){var alpha=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var omega=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return getCachedAt(alpha)===getCachedAt(omega)&&getCacheFor(alpha)===getCacheFor(omega);};exports.isEqual=isEqual;var isHardStorage=function isHardStorage(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref2$cacheFor=_ref2.cacheFor,cacheFor=_ref2$cacheFor===void 0?0:_ref2$cacheFor;return cacheFor>=1000*60*60*24;};exports.isHardStorage=isHardStorage;var isSoftStorage=function isSoftStorage(){var _ref3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref3$cacheFor=_ref3.cacheFor,cacheFor=_ref3$cacheFor===void 0?0:_ref3$cacheFor;return cacheFor>=1000*60*60&&cacheFor<1000*60*60*24;};exports.isSoftStorage=isSoftStorage;var hasComparator=function hasComparator(){var _ref4=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref4$comparator=_ref4.comparator,comparator=_ref4$comparator===void 0?null:_ref4$comparator;return comparator instanceof Function;};exports.hasComparator=hasComparator;var filterFor=function filterFor(t){return function(){var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref5.type;return type===t;};};exports.filterFor=filterFor;var filterMetaFor=function filterMetaFor(t){return function(){var _ref6=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref6$meta=_ref6.meta;_ref6$meta=_ref6$meta===void 0?{}:_ref6$meta;var type=_ref6$meta.type;return type===t;};};exports.filterMetaFor=filterMetaFor;var mapType=function mapType(){var _ref7=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref7$type=_ref7.type,type=_ref7$type===void 0?null:_ref7$type;return type;};exports.mapType=mapType;var mapMetaType=function mapMetaType(){var _ref8=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref8$meta=_ref8.meta;_ref8$meta=_ref8$meta===void 0?{}:_ref8$meta;var _ref8$meta$type=_ref8$meta.type,type=_ref8$meta$type===void 0?null:_ref8$meta$type;return type;};exports.mapMetaType=mapMetaType;var mapCacheFor=function mapCacheFor(){var _ref9=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref9$meta=_ref9.meta;_ref9$meta=_ref9$meta===void 0?{}:_ref9$meta;var _ref9$meta$cacheFor=_ref9$meta.cacheFor,cacheFor=_ref9$meta$cacheFor===void 0?0:_ref9$meta$cacheFor;return cacheFor;};exports.mapCacheFor=mapCacheFor;var mapCachedAt=function mapCachedAt(){var _ref10=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref10$meta=_ref10.meta;_ref10$meta=_ref10$meta===void 0?{}:_ref10$meta;var _ref10$meta$cachedAt=_ref10$meta.cachedAt,cachedAt=_ref10$meta$cachedAt===void 0?0:_ref10$meta$cachedAt;return cachedAt;};exports.mapCachedAt=mapCachedAt;var createIsHardStorage=function createIsHardStorage(meta){return _objectSpread({},meta,isHardStorage(meta)?{isHardStorage:true}:{});};exports.createIsHardStorage=createIsHardStorage;var createIsSoftStorage=function createIsSoftStorage(meta){return _objectSpread({},meta,isSoftStorage(meta)?{isSoftStorage:true}:{});};exports.createIsSoftStorage=createIsSoftStorage;var createComparator=function createComparator(){var _ref11=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref11$comparator=_ref11.comparator,comparator=_ref11$comparator===void 0?null:_ref11$comparator,meta=_objectWithoutProperties(_ref11,["comparator"]);return _objectSpread({},meta,comparator?{comparator:comparator}:{});};exports.createComparator=createComparator;var createAccessedAt=function createAccessedAt(){var _ref12=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref12$accessedAt=_ref12.accessedAt,accessedAt=_ref12$accessedAt===void 0?null:_ref12$accessedAt,meta=_objectWithoutProperties(_ref12,["accessedAt"]);return _objectSpread({},meta,accessedAt?{accessedAt:accessedAt}:{});};exports.createAccessedAt=createAccessedAt;var createCachedAt=function createCachedAt(){var _ref13=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref13$cachedAt=_ref13.cachedAt,cachedAt=_ref13$cachedAt===void 0?null:_ref13$cachedAt,meta=_objectWithoutProperties(_ref13,["cachedAt"]);return _objectSpread({},meta,cachedAt?{cachedAt:cachedAt}:{});};exports.createCachedAt=createCachedAt;var createCacheFor=function createCacheFor(){var _ref14=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref14$cacheFor=_ref14.cacheFor,cacheFor=_ref14$cacheFor===void 0?null:_ref14$cacheFor,meta=_objectWithoutProperties(_ref14,["cacheFor"]);return _objectSpread({},meta,cacheFor?{cacheFor:cacheFor}:{});};exports.createCacheFor=createCacheFor;var createMeta=function createMeta(){var meta=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return createIsHardStorage(createIsSoftStorage(createCacheFor(createCachedAt(createAccessedAt(createComparator(meta))))));};exports.createMeta=createMeta;var hasCacheFor=function hasCacheFor(value){return Math.floor(Number(value))>0;};exports.hasCacheFor=hasCacheFor;var notCacheFor=function notCacheFor(value){return isNaN(Number(value))||Math.floor(Number(value))<1;};exports.notCacheFor=notCacheFor;var filterFetch=function filterFetch(){var _ref15=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref15$meta=_ref15.meta;_ref15$meta=_ref15$meta===void 0?{}:_ref15$meta;var type=_ref15$meta.type,_ref15$meta$cacheFor=_ref15$meta.cacheFor,cacheFor=_ref15$meta$cacheFor===void 0?0:_ref15$meta$cacheFor;return hasCacheFor(cacheFor);};exports.filterFetch=filterFetch;var filterStore=function filterStore(){var _ref16=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref16$meta=_ref16.meta;_ref16$meta=_ref16$meta===void 0?{}:_ref16$meta;var type=_ref16$meta.type,_ref16$meta$cacheFor=_ref16$meta.cacheFor,cacheFor=_ref16$meta$cacheFor===void 0?0:_ref16$meta$cacheFor;return hasCacheFor(cacheFor);};exports.filterStore=filterStore;var filterClear=function filterClear(){var _ref17=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref17$meta=_ref17.meta;_ref17$meta=_ref17$meta===void 0?{}:_ref17$meta;var type=_ref17$meta.type,_ref17$meta$cacheFor=_ref17$meta.cacheFor,cacheFor=_ref17$meta$cacheFor===void 0?0:_ref17$meta$cacheFor;return notCacheFor(cacheFor);};exports.filterClear=filterClear;var reduce=function reduce(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref18=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref18.type,meta=_ref18.meta,_ref18$meta=_ref18.meta;_ref18$meta=_ref18$meta===void 0?{}:_ref18$meta;var _ref18$meta$cacheFor=_ref18$meta.cacheFor,cacheFor=_ref18$meta$cacheFor===void 0?0:_ref18$meta$cacheFor;var i=arguments.length>2?arguments[2]:undefined;var array=arguments.length>3?arguments[3]:undefined;return a.map(mapType).includes(type)?array.filter(filterFor(type)).reduce(dedupeMeta,[]):min(array.filter(filterFor(type)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.reduce=reduce;var dedupeMeta=function dedupeMeta(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref19=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref19.type,meta=_ref19.meta,_ref19$meta=_ref19.meta;_ref19$meta=_ref19$meta===void 0?{}:_ref19$meta;var _ref19$meta$cacheFor=_ref19$meta.cacheFor,cacheFor=_ref19$meta$cacheFor===void 0?0:_ref19$meta$cacheFor,t=_ref19$meta.type;var i=arguments.length>2?arguments[2]:undefined;var array=arguments.length>3?arguments[3]:undefined;return a.map(mapMetaType).includes(t)?a:min(array.filter(filterMetaFor(t)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.dedupeMeta=dedupeMeta;var reduceFetch=function reduceFetch(){return reduce.apply(void 0,arguments);};exports.reduceFetch=reduceFetch;var reduceStore=function reduceStore(){return reduce.apply(void 0,arguments);};exports.reduceStore=reduceStore;var reduceClear=function reduceClear(){return reduce.apply(void 0,arguments);};exports.reduceClear=reduceClear;var reduceMetaFetch=function reduceMetaFetch(){return reduceFetch.apply(void 0,arguments);};exports.reduceMetaFetch=reduceMetaFetch;var reduceMetaStore=function reduceMetaStore(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref20=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref20.type,meta=_ref20.meta,_ref20$meta=_ref20.meta;_ref20$meta=_ref20$meta===void 0?{}:_ref20$meta;var _ref20$meta$cacheFor=_ref20$meta.cacheFor,cacheFor=_ref20$meta$cacheFor===void 0?0:_ref20$meta$cacheFor,t=_ref20$meta.type;var i=arguments.length>2?arguments[2]:undefined;var array=arguments.length>3?arguments[3]:undefined;return a.map(mapType).includes(type)?array.filter(filterFor(type)).reduce(dedupeMeta,[]):min(array.filter(filterMetaFor(t)).map(mapCacheFor))!==cacheFor?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.reduceMetaStore=reduceMetaStore;var dedupeFetch=function dedupeFetch(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref21=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref21.type,meta=_ref21.meta;return a.map(mapMetaType).includes(type)?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.dedupeFetch=dedupeFetch;var dedupeStore=function dedupeStore(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref22=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref22.type,meta=_ref22.meta,_ref22$meta=_ref22.meta;_ref22$meta=_ref22$meta===void 0?{}:_ref22$meta;var t=_ref22$meta.type;return a.map(mapMetaType).includes(t)?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.dedupeStore=dedupeStore;var dedupeClear=function dedupeClear(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var _ref23=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref23.type,meta=_ref23.meta,_ref23$meta=_ref23.meta;_ref23$meta=_ref23$meta===void 0?{}:_ref23$meta;var t=_ref23$meta.type;return a.map(mapMetaType).includes(t)?a:a.concat(_objectSpread({type:type},meta?{meta:meta}:{}));};exports.dedupeClear=dedupeClear;var dedupeMetaFetch=function dedupeMetaFetch(){return dedupeFetch.apply(void 0,arguments);};exports.dedupeMetaFetch=dedupeMetaFetch;var dedupeMetaStore=function dedupeMetaStore(){return dedupeMeta.apply(void 0,arguments);};exports.dedupeMetaStore=dedupeMetaStore;var filterHardStorage=function filterHardStorage(){var _ref24=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref24.meta;return isHardStorage(meta);};exports.filterHardStorage=filterHardStorage;var filterSoftStorage=function filterSoftStorage(){var _ref25=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref25.meta;return isSoftStorage(meta);};exports.filterSoftStorage=filterSoftStorage;var filterStorage=function filterStorage(){var _ref26=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},meta=_ref26.meta;return!(isHardStorage(meta)||isSoftStorage(meta));};exports.filterStorage=filterStorage;var filterNotFetchMap=function filterNotFetchMap(){var _ref27=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref27$fetchMap=_ref27.fetchMap,fetchMap=_ref27$fetchMap===void 0?new Map():_ref27$fetchMap;var _ref28=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref28$meta=_ref28.meta;_ref28$meta=_ref28$meta===void 0?{}:_ref28$meta;var type=_ref28$meta.type;return!fetchMap.has(type);};exports.filterNotFetchMap=filterNotFetchMap;var filterNotStoreMap=function filterNotStoreMap(){var _ref29=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref29$storeMap=_ref29.storeMap,storeMap=_ref29$storeMap===void 0?new Map():_ref29$storeMap;var _ref30=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref30$meta=_ref30.meta;_ref30$meta=_ref30$meta===void 0?{}:_ref30$meta;var type=_ref30$meta.type;return!storeMap.has(type);};exports.filterNotStoreMap=filterNotStoreMap;var filterIsUniqueMap=function filterIsUniqueMap(){var _ref31=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref31$fetchMap=_ref31.fetchMap,fetchMap=_ref31$fetchMap===void 0?new Map():_ref31$fetchMap,_ref31$storeMap=_ref31.storeMap,storeMap=_ref31$storeMap===void 0?new Map():_ref31$storeMap;var _ref32=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref32$meta=_ref32.meta;_ref32$meta=_ref32$meta===void 0?{}:_ref32$meta;var type=_ref32$meta.type;return!(fetchMap.has(type)||storeMap.has(type));};exports.filterIsUniqueMap=filterIsUniqueMap;var putIntoFetchMap=function putIntoFetchMap(){var _ref33=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref33$fetchMap=_ref33.fetchMap,fetchMap=_ref33$fetchMap===void 0?new Map():_ref33$fetchMap;var _ref34=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref34.type,_ref34$meta=_ref34.meta;_ref34$meta=_ref34$meta===void 0?{}:_ref34$meta;var cacheFor=_ref34$meta.cacheFor,comparator=_ref34$meta.comparator;fetchMap.set(type,_objectSpread({type:type,cacheFor:cacheFor},comparator instanceof Function?{comparator:comparator}:{}));};exports.putIntoFetchMap=putIntoFetchMap;var putIntoStoreMap=function putIntoStoreMap(){var _ref35=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref35$storeMap=_ref35.storeMap,storeMap=_ref35$storeMap===void 0?new Map():_ref35$storeMap;var _ref36=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref36.type,_ref36$meta=_ref36.meta;_ref36$meta=_ref36$meta===void 0?{}:_ref36$meta;var TYPE=_ref36$meta.type,meta=_objectWithoutProperties(_ref36$meta,["type"]);var storeSet=storeMap.get(TYPE)||new Set();storeMap.set(TYPE,storeSet.add(_objectSpread({},meta,{type:type})));};exports.putIntoStoreMap=putIntoStoreMap;var putIntoClearMap=function putIntoClearMap(){var _ref37=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref37$clearMap=_ref37.clearMap,clearMap=_ref37$clearMap===void 0?new Map():_ref37$clearMap;var _ref38=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref38.type,_ref38$meta=_ref38.meta;_ref38$meta=_ref38$meta===void 0?{}:_ref38$meta;var TYPE=_ref38$meta.type,cacheFor=_ref38$meta.cacheFor,meta=_objectWithoutProperties(_ref38$meta,["type","cacheFor"]);var clearSet=clearMap.get(TYPE)||new Set();clearMap.set(TYPE,clearSet.add(_objectSpread({},meta,{type:type},cacheFor?{cacheFor:cacheFor}:{},{isNaN:isNaN(cacheFor)})));};exports.putIntoClearMap=putIntoClearMap;var putIntoFetchMetaMap=function putIntoFetchMetaMap(){var _ref39=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref39$fetchMetaMap=_ref39.fetchMetaMap,fetchMetaMap=_ref39$fetchMetaMap===void 0?new Map():_ref39$fetchMetaMap;var _ref40=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},type=_ref40.type,_ref40$meta=_ref40.meta;_ref40$meta=_ref40$meta===void 0?{}:_ref40$meta;var cacheFor=_ref40$meta.cacheFor,meta=_objectWithoutProperties(_ref40$meta,["cacheFor"]);var fetchMetaSet=fetchMetaMap.get(type)||new Set();fetchMetaMap.set(type,fetchMetaSet.add(_objectSpread({},meta,{cacheFor:cacheFor})));};exports.putIntoFetchMetaMap=putIntoFetchMetaMap;var putIntoStoreMetaMap=function putIntoStoreMetaMap(){var _ref41=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref41$storeMetaMap=_ref41.storeMetaMap,storeMetaMap=_ref41$storeMetaMap===void 0?new Map():_ref41$storeMetaMap;var _ref42=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref42$meta=_ref42.meta;_ref42$meta=_ref42$meta===void 0?{}:_ref42$meta;var type=_ref42$meta.type,cacheFor=_ref42$meta.cacheFor;storeMetaMap.set(type,{type:type,cacheFor:cacheFor});};exports.putIntoStoreMetaMap=putIntoStoreMetaMap;var filterHardStorageArray=function filterHardStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterHardStorage);};exports.filterHardStorageArray=filterHardStorageArray;var filterSoftStorageArray=function filterSoftStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterSoftStorage);};exports.filterSoftStorageArray=filterSoftStorageArray;var filterStorageArray=function filterStorageArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterStorage);};exports.filterStorageArray=filterStorageArray;var filterFetchArray=function filterFetchArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterFetch);};exports.filterFetchArray=filterFetchArray;var filterStoreArray=function filterStoreArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterStore);};exports.filterStoreArray=filterStoreArray;var filterClearArray=function filterClearArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(filterClear);};exports.filterClearArray=filterClearArray;var filterNotFetchMapArray=function filterNotFetchMapArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return array.filter(function(configuration){return filterNotFetchMap(params,configuration);});};exports.filterNotFetchMapArray=filterNotFetchMapArray;var filterIsUniqueMapArray=function filterIsUniqueMapArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return array.filter(function(configuration){return filterIsUniqueMap(params,configuration);});};exports.filterIsUniqueMapArray=filterIsUniqueMapArray;var createFetchMetaArray=function createFetchMetaArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceMetaFetch,[]).reduce(dedupeMetaFetch,[]);};exports.createFetchMetaArray=createFetchMetaArray;var createStoreMetaArray=function createStoreMetaArray(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.reduce(reduceMetaStore,[]).reduce(dedupeMetaStore,[]);};exports.createStoreMetaArray=createStoreMetaArray;var getCachedAt=function getCachedAt(){var _ref43=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref43$cachedAt=_ref43.cachedAt,cachedAt=_ref43$cachedAt===void 0?0:_ref43$cachedAt;return cachedAt;};exports.getCachedAt=getCachedAt;var getCacheFor=function getCacheFor(){var _ref44=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref44$cacheFor=_ref44.cacheFor,cacheFor=_ref44$cacheFor===void 0?0:_ref44$cacheFor;return cacheFor;};exports.getCacheFor=getCacheFor;function initialiseFetchMetaMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};array.forEach(function(configuration){putIntoFetchMetaMap(params,configuration);});}function initialiseFetchHardStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};filterHardStorageArray(array).reduce(reduceFetch,[]).forEach(function(configuration){putIntoFetchMap(params,configuration);});}function initialiseFetchSoftStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};filterSoftStorageArray(array).reduce(reduceFetch,[]).forEach(function(configuration){putIntoFetchMap(params,configuration);});}function initialiseFetchStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};filterStorageArray(array).reduce(reduceFetch,[]).forEach(function(configuration){putIntoFetchMap(params,configuration);});}function initialiseFetch(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fetchArray=filterFetchArray(array);initialiseFetchHardStorage(fetchArray,params);initialiseFetchSoftStorage(fetchArray,params);initialiseFetchStorage(fetchArray,params);}function initialiseStoreMetaMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};array.forEach(function(configuration){putIntoStoreMetaMap(params,configuration);});}function initialiseStoreNotFetchMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};filterNotFetchMapArray(array,params).reduce(reduceStore,[]).forEach(function(configuration){return putIntoStoreMap(params,configuration);});}function initialiseStoreHardStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var hardStorageArray=filterHardStorageArray(array);initialiseStoreNotFetchMap(hardStorageArray,params);initialiseFetchMetaMap(createFetchMetaArray(hardStorageArray),params);initialiseStoreMetaMap(createStoreMetaArray(hardStorageArray),params);}function initialiseStoreSoftStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var softStorageArray=filterSoftStorageArray(array);initialiseStoreNotFetchMap(softStorageArray,params);initialiseFetchMetaMap(createFetchMetaArray(softStorageArray),params);initialiseStoreMetaMap(createStoreMetaArray(softStorageArray),params);}function initialiseStoreStorage(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var storageArray=filterStorageArray(array);initialiseStoreNotFetchMap(storageArray,params);initialiseFetchMetaMap(createFetchMetaArray(storageArray),params);initialiseStoreMetaMap(createStoreMetaArray(storageArray),params);}function initialiseStore(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var storeArray=filterStoreArray(array);initialiseStoreHardStorage(storeArray,params);initialiseStoreSoftStorage(storeArray,params);initialiseStoreStorage(storeArray,params);}function initialiseClearIsUniqueMap(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};filterIsUniqueMapArray(array,params).reduce(reduceClear,[]).forEach(function(configuration){return putIntoClearMap(params,configuration);});}function initialiseClear(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var clearArray=filterClearArray(array);initialiseClearIsUniqueMap(clearArray,params);}function initialise(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};initialiseFetch(array,params);initialiseStore(array,params);initialiseClear(array,params);}var getStateFromStore=function getStateFromStore(){var _ref45=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref45$reduxStorage=_ref45.reduxStorage,reduxStorage=_ref45$reduxStorage===void 0?{}:_ref45$reduxStorage;return reduxStorage;};var getStateForActionType=function getStateForActionType(type){var _ref46=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref46$type=_ref46[type],state=_ref46$type===void 0?{}:_ref46$type;return state;};var _default=function _default(array){var configuration=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(Array.isArray(array)){var _configuration$fetchM=configuration.fetchMap,fetchMap=_configuration$fetchM===void 0?new Map():_configuration$fetchM,_configuration$storeM=configuration.storeMap,storeMap=_configuration$storeM===void 0?new Map():_configuration$storeM,_configuration$fetchM2=configuration.fetchMetaMap,fetchMetaMap=_configuration$fetchM2===void 0?new Map():_configuration$fetchM2,_configuration$storeM2=configuration.storeMetaMap,storeMetaMap=_configuration$storeM2===void 0?new Map():_configuration$storeM2,_configuration$clearM=configuration.clearMap,clearMap=_configuration$clearM===void 0?new Map():_configuration$clearM;initialise(array,{fetchMap:fetchMap,storeMap:storeMap,fetchMetaMap:fetchMetaMap,storeMetaMap:storeMetaMap,clearMap:clearMap});return function(store){return function(next){return function(){var _ref47=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},type=_ref47.type,action=_objectWithoutProperties(_ref47,["type"]);if(fetchMap.has(type)){var accessedAt=Date.now();var _getStateForActionTyp=getStateForActionType(type,getStateFromStore(store.getState())),_getStateForActionTyp2=_getStateForActionTyp.meta;_getStateForActionTyp2=_getStateForActionTyp2===void 0?fetchMap.get(type):_getStateForActionTyp2;var cacheFor=_getStateForActionTyp2.cacheFor,cachedAt=_getStateForActionTyp2.cachedAt;var META=createMeta({type:type,cacheFor:cacheFor,cachedAt:cachedAt,accessedAt:accessedAt});if(isStale(META)){store.dispatch((0,_actions.storageWriteAction)(META,_objectSpread({},action,{type:type})));if(fetchMetaMap.has(type)){var fetchMetaSet=fetchMetaMap.get(type);fetchMetaSet.forEach(function(_ref48){var type=_ref48.type;var state=getStateForActionType(type,getStateFromStore(store.getState()));var meta=state.meta;if(meta){var _cacheFor=meta.cacheFor,_cachedAt=meta.cachedAt;var data=state.data;var _META=createMeta({type:type,cacheFor:_cacheFor,cachedAt:_cachedAt,accessedAt:accessedAt});store.dispatch((0,_actions.storageClearAction)(_META,data));}});}return next(_objectSpread({},action,{type:type}));}else{store.dispatch((0,_actions.storageFetchAction)(META,_objectSpread({},action,{type:type})));if(fetchMetaMap.has(type)){var _fetchMetaSet=fetchMetaMap.get(type);_fetchMetaSet.forEach(function(_ref49){var type=_ref49.type;var state=getStateForActionType(type,getStateFromStore(store.getState()));var meta=state.meta;if(meta){var _cacheFor2=meta.cacheFor,_cachedAt2=meta.cachedAt;var data=state.data;var _META2=createMeta({type:type,cacheFor:_cacheFor2,cachedAt:_cachedAt2,accessedAt:accessedAt});store.dispatch((0,_actions.storageFetchAction)(_META2,data));if(data)store.dispatch(data);}});}return _objectSpread({},action,{type:type});}}else{if(storeMap.has(type)){var _accessedAt=Date.now();var storeSet=storeMap.get(type);storeSet.forEach(function(_ref50){var type=_ref50.type,cacheFor=_ref50.cacheFor;var _getStateForActionTyp3=getStateForActionType(type,getStateFromStore(store.getState())),data=_getStateForActionTyp3.data,_getStateForActionTyp4=_getStateForActionTyp3.meta;_getStateForActionTyp4=_getStateForActionTyp4===void 0?{}:_getStateForActionTyp4;var _getStateForActionTyp5=_getStateForActionTyp4.cachedAt,cachedAt=_getStateForActionTyp5===void 0?_accessedAt:_getStateForActionTyp5;var META=createMeta({type:type,cacheFor:cacheFor,cachedAt:cachedAt,accessedAt:_accessedAt});store.dispatch((0,_actions.storageStoreAction)(META,data));});if(storeMetaMap.has(type)){var _getStateForActionTyp6=getStateForActionType(type,getStateFromStore(store.getState())),_getStateForActionTyp7=_getStateForActionTyp6.meta;_getStateForActionTyp7=_getStateForActionTyp7===void 0?storeMetaMap.get(type):_getStateForActionTyp7;var _cacheFor3=_getStateForActionTyp7.cacheFor,_cachedAt3=_getStateForActionTyp7.cachedAt;var _META3=createMeta({type:type,cacheFor:_cacheFor3,cachedAt:_cachedAt3,accessedAt:_accessedAt});store.dispatch((0,_actions.storageStoreAction)(_META3,_objectSpread({},action,{type:type})));}return next(_objectSpread({},action,{type:type}));}}return next(_objectSpread({},action,{type:type}));};};};}return function(){return function(next){return function(action){return next(action);};};};};exports.default=_default;